<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Automatic tracking &mdash; OrganoidTracker 2.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Plugin tutorial" href="PLUGIN_TUTORIAL.html" />
    <link rel="prev" title="Manual tracking and error correction" href="MANUAL_TRACKING.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> OrganoidTracker
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="MANUAL_TRACKING.html">Manual tracking and error correction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Automatic tracking</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#step-1-obtaining-nucleus-positions">Step 1: Obtaining nucleus positions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#correcting-for-changed-image-offsets">Correcting for changed image offsets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step-2-obtaining-division-scores">Step 2: Obtaining division scores</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-3-obtaining-link-scores">Step 3: Obtaining link scores</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-4-obtaining-links">Step 4: Obtaining links</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-5-calculate-error-rates">Step 5: Calculate error rates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-6-manually-correct-warnings">Step 6: Manually correct warnings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-to-do-if-my-results-aren-t-good">What to do if my results aren’t good?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-7-automated-analysis">Step 7: Automated analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="PLUGIN_TUTORIAL.html">Plugin tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="TRAINING_THE_NETWORK.html">Training the neural network</a></li>
<li class="toctree-l1"><a class="reference internal" href="JUPYTER_NOTEBOOK.html">Jupyter notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="WORKING_WITH_CUSTOM_METADATA.html">Working with custom metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="SEGMENTATION_EDITOR.html">Segmentation masks editor</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="API.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="BATCH_EDITING.html">Batch operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="CUSTOM_TRACKING_FORMATS.html">Custom tracking formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="DATA_AXES.html">The data axes editor</a></li>
<li class="toctree-l1"><a class="reference internal" href="IMAGE_FORMATS.html">Supported image formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="INSTALLATION.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="SCRIPTS.html">The scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="TRACKING_FORMATS.html">Supported tracking formats</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Browse the code</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="organoid_tracker.html">organoid_tracker package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OrganoidTracker</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Automatic tracking</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/AUTOMATIC_TRACKING.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="automatic-tracking">
<h1>Automatic tracking<a class="headerlink" href="#automatic-tracking" title="Permalink to this heading"></a></h1>
<p><a class="reference internal" href="index.html"><span class="doc std std-doc">← Back to main page</span></a></p>
<p>The intended workflow is as follows:</p>
<ol class="arabic simple">
<li><p>Obtain nucleus positions (for now this is done using an external program)</p></li>
<li><p>Obtain division probabilities.</p></li>
<li><p>Obtain linking probabilities.</p></li>
<li><p>Link the cell detections at different time points together</p></li>
<li><p>Calculate error probabilities</p></li>
<li><p>Manually correct warnings</p></li>
<li><p>OR Filter and do automated analysis</p></li>
</ol>
<p>The steps are described below.</p>
<p>Before you start, create a directory that will hold all your analysis data. You can create this directory inside the directory that holds your images.</p>
<section id="step-1-obtaining-nucleus-positions">
<h2>Step 1: Obtaining nucleus positions<a class="headerlink" href="#step-1-obtaining-nucleus-positions" title="Permalink to this heading"></a></h2>
<p>To get the best results it is key that the input data somewhat resembles the data being trained on. This can often simply be achieved with a little pre-processing (<a class="reference internal" href="PREPROCESSING_TIPS.html"><span class="doc std std-doc">See here for tips</span></a>).</p>
<p>Open the OrganoidTracker GUI, load your images and select <code class="docutils literal notranslate"><span class="pre">Tools</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Detect</span> <span class="pre">cells</span> <span class="pre">in</span> <span class="pre">images...</span></code>. Select the already trained neural network that you want to use. (<a class="reference internal" href="TRAINING_THE_NETWORK.html"><span class="doc std std-doc">See here for how to train a model</span></a> or find links to pre-trained models at <a class="reference external" href="https://github.com/jvzonlab/OrganoidTracker">our Github page</a>.) You’ll end up with a folder containing configuration files. Run the <code class="docutils literal notranslate"><span class="pre">organoid_tracker_predict_positions</span></code> script in that directory to put the neural network into action. (On Windows, double-click the BAT file. On Linux/macOs, run the SH file instead.) You’ll end up with a file that contains the positions of the cells. Load it into the program to see how the neural network performed.</p>
<p>If you want to debug what the program is doing, open the <code class="docutils literal notranslate"><span class="pre">organoid_tracker.ini</span></code> file and give the <code class="docutils literal notranslate"><span class="pre">predictions_output_folder</span></code> setting a value, for example <code class="docutils literal notranslate"><span class="pre">test</span></code>. If you run the script again, it will create a folder with that name (<code class="docutils literal notranslate"><span class="pre">test</span></code> in this example) and place images there indicating how likely it is to find a cell there.</p>
<section id="correcting-for-changed-image-offsets">
<h3>Correcting for changed image offsets<a class="headerlink" href="#correcting-for-changed-image-offsets" title="Permalink to this heading"></a></h3>
<p>When taking longer time lapse movies, the organoid can slowly slide out of the view. For this reason, the microscope user can move the imaged area so that the organoid stays in the view. In the time lapse movie, this makes the organoid appear to “teleport”: from the edges of the image it jumps back to the center.</p>
<p>To create links over this “jump”, the program would need to create a lot of large-distance links. The program will likely refuse to do this. To correct for this, <em>before running the linking process</em>, open the OrganoidTracker GUI and load the images and positions (<code class="docutils literal notranslate"><span class="pre">File</span></code> menu). Then edit the data (<code class="docutils literal notranslate"><span class="pre">Edit</span> <span class="pre">-&gt;</span> <span class="pre">Manually</span> <span class="pre">change</span> <span class="pre">data...</span></code>) and edit the image offsets (<code class="docutils literal notranslate"><span class="pre">Edit</span> <span class="pre">-&gt;</span> <span class="pre">Edit</span> <span class="pre">image</span> <span class="pre">offsets...</span></code>) of the correct time point. Instructions are on the bottom of the window.</p>
</section>
</section>
<section id="step-2-obtaining-division-scores">
<h2>Step 2: Obtaining division scores<a class="headerlink" href="#step-2-obtaining-division-scores" title="Permalink to this heading"></a></h2>
<p>Open the OrganoidTracker GUI again and load the images and the positions from the previous step. Select <code class="docutils literal notranslate"><span class="pre">Tools</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Detect</span> <span class="pre">dividing</span> <span class="pre">cells...</span></code> and follow the steps. Run the <code class="docutils literal notranslate"><span class="pre">organoid_tracker_predict_divisions</span></code> script.After the script is finished, which should be after a few minutes, you can load the resulting data in OrganoidTracker.</p>
<p>If you double-click on a cell in the main window, you can view its data. Among that data, you should now see the division probability. Verify that this probability is what you would expect: high for cells that are about to divide, low otherwise.</p>
</section>
<section id="step-3-obtaining-link-scores">
<h2>Step 3: Obtaining link scores<a class="headerlink" href="#step-3-obtaining-link-scores" title="Permalink to this heading"></a></h2>
<p>This step works the same as the above script, except that you now run <code class="docutils literal notranslate"><span class="pre">Tools</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Detect</span> <span class="pre">link</span> <span class="pre">likelihoods...</span></code>. This script will predict the scores for all links that OrganoidTracker considers to be possible. (That are links to the nearest position, plus links to positions at most two times as far as the nearest position.)</p>
</section>
<section id="step-4-obtaining-links">
<h2>Step 4: Obtaining links<a class="headerlink" href="#step-4-obtaining-links" title="Permalink to this heading"></a></h2>
<p>Open the OrganoidTracker GUI again and load the images and the output file from the previous step. Use <code class="docutils literal notranslate"><span class="pre">Tools</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Create</span> <span class="pre">links</span> <span class="pre">between</span> <span class="pre">time</span> <span class="pre">points...</span></code> and run the resulting <code class="docutils literal notranslate"><span class="pre">organoid_tracker_create_links</span></code> script.</p>
<p>In order for the tracking to work we need to give the algorithm a few more probabilities to work with, these can be adjusted in the <code class="docutils literal notranslate"><span class="pre">organoid_tracker.ini</span></code> file. The first is the probability of a cell disappearing. This is simply the false negative rate of the cell detection plus the death rate of cells in the system. The appearance probability is again given by false negative rate alone. Cells can of course also appear from outside the field of view, to account for this you can set the maximum distance from which a cell could move out of view in a single timepoint. The (dis)appearance probabilities are then adjusted automatically near the edges of the imaging volume. It is good to note that the exact values of these probabilities should not substantially change the results in our experience, so a reasonable estimate will do.</p>
<p>Now you can also set some parameters to clean up the data after tracking. It is advisable to at least remove very short tracks for clarity.</p>
<p>This step outputs both a file containing the tracks and a file in which all links are retained. The latter is important when calculating error rates.</p>
</section>
<section id="step-5-calculate-error-rates">
<h2>Step 5: Calculate error rates<a class="headerlink" href="#step-5-calculate-error-rates" title="Permalink to this heading"></a></h2>
<p>Now that we have the tracks we can compute error rates through marginalization. Use <code class="docutils literal notranslate"><span class="pre">Tools</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Compute</span> <span class="pre">marginalized</span> <span class="pre">error</span> <span class="pre">rates...</span></code> and run the resulting <code class="docutils literal notranslate"><span class="pre">organoid_tracker_marginalize</span></code> script.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">organoid_tracker.ini</span></code> file you might need to change the so-called ‘temperature’. This accounts for the amount of shared information between the individual neural network predictions. If your data is similar to the data the neural networks are trained on you can use the temperature associated with them (1.5 for our intestinal organoid models). If you have trained your own models you have to calibrate the marginalization procedure to get a temperature (<a class="reference internal" href="CALIBRATE_MARGINALIZATION.html"><span class="doc std std-doc">See here for how to calibrate</span></a>). It is good to note that this temperature is generally able to absorb any miscalibration of the neural network outputs as well.</p>
<p>This step also gives you dataset where all low-confidence links are filtered out. The threshold can be set in the <code class="docutils literal notranslate"><span class="pre">organoid_tracker.ini</span></code> file.</p>
</section>
<section id="step-6-manually-correct-warnings">
<h2>Step 6: Manually correct warnings<a class="headerlink" href="#step-6-manually-correct-warnings" title="Permalink to this heading"></a></h2>
<p>This step is not automated. 😉 Open the OrganoidTracker GUI and load the images and data (<code class="docutils literal notranslate"><span class="pre">File</span></code> menu). Then go to <code class="docutils literal notranslate"><span class="pre">Edit</span> <span class="pre">-&gt;</span> <span class="pre">Manually</span> <span class="pre">change</span> <span class="pre">data...</span></code>. A cross will appear over all locations where the program has detected some inconsistency in the tracking data:</p>
<p><img alt="Example of a warning" src="_images/warning.png" /></p>
<p>To view why OrganoidTracker warned you about this position, hover you mouse over a nucleus and press E. This will show you what the warning is. If the warning was a false positive, just press Delete to delete the warning. Otherwise, exit the warning screen (press E or Escape). This takes you back to the cell track editor, where you can fix the error.</p>
<p>Data editing is done mainly using the Insert and Delete keys, which are used to insert and delete links. Detected positions can also be inserted and deleted if necessary. Because correcting data works exactly the same as manual tracking, please see the <a class="reference internal" href="MANUAL_TRACKING.html"><span class="doc std std-doc">manual tracking</span></a> tutorial for more information.</p>
<p>If you press Left and Right in the warning screen, you will be taken to other warnings in the same lineage. If you press Up or Down, you will be taken to the warnings of other lineage trees.</p>
<p>If you press the L key from the cell track editor, a screen is opened that shows whether there are still warnings remaining in the lineage of that cell. If you hover your mouse over such a lineage and press E, the program will take you to the (first) warning in that lineage tree.</p>
<p>If you don’t want to correct everything, there are several options:</p>
<ul class="simple">
<li><p>Limiting the number of time steps that you are looking at. In the warning screen, if you open the Edit menu, there’s an option to set the minimum and maximum time point for correction.</p></li>
<li><p>Limiting the area you are looking at. This is most easily done by pressing L in the cell track editor, and then observing any lineages that still have warnings. Correct any lineages that need to be corrected (press E while you hover your mouse over them). Once you are satisfied, you can then delete all lineages that still have errors in them. This is done from the cell track editor: press <code class="docutils literal notranslate"><span class="pre">Edit</span> <span class="pre">&gt;</span> <span class="pre">Batch</span> <span class="pre">deletion</span> <span class="pre">&gt;</span> <span class="pre">Delete</span> <span class="pre">lineages</span> <span class="pre">with</span> <span class="pre">errors</span></code>. See <span class="xref myst">batch editing</span> for more ways to delete a lot of lineages at once.</p></li>
</ul>
<p>You can change a few settings of the error checker, to make it stricter or less strict. In the error checking screen (the screen you opened with <code class="docutils literal notranslate"><span class="pre">E</span></code>) there are three options available in the <code class="docutils literal notranslate"><span class="pre">Edit</span></code> menu: the minimimum marginalized probability a link should have, the minimum time in between two cell divisions of the same cell, and the maximum distance a cell may move per minute (only useful before marginalization).</p>
<p>Often correcting mistakes below a certain threshold also fixes a few mistakes that were not flagged. The increase in tracking quality might therefore be more than naively expected. To check the resulting quality you can rerun the marginalization on your corrected data while flagging in the <code class="docutils literal notranslate"><span class="pre">organoid_tracker.ini</span></code> file that you have checked part or all of the errors.</p>
</section>
<section id="what-to-do-if-my-results-aren-t-good">
<h2>What to do if my results aren’t good?<a class="headerlink" href="#what-to-do-if-my-results-aren-t-good" title="Permalink to this heading"></a></h2>
<p>That’s a difficult problem! You have a few options:</p>
<ul class="simple">
<li><p>Improve image quality. The images should be good enough that it is straightforward to track the nuclei by hand in the large majority of cases.</p></li>
<li><p>Change some settings. The generated <code class="docutils literal notranslate"><span class="pre">organoid_tracker.ini</span></code> files contain an explanation for each of the settings.</p></li>
<li><p><a class="reference internal" href="TRAINING_THE_NETWORK.html"><span class="doc std std-doc">Retrain the neural networks for your data.</span></a></p></li>
<li><p><a class="reference internal" href="CUSTOM_TRACKING_SCRIPTS.html"><span class="doc std std-doc">Replace parts of the tracker with custom code</span></a></p></li>
</ul>
</section>
<section id="step-7-automated-analysis">
<h2>Step 7: Automated analysis<a class="headerlink" href="#step-7-automated-analysis" title="Permalink to this heading"></a></h2>
<p>In step 5 a set of filtered high-confidence tracks is produced. You can choose to analyze these further. Generally for many application, manual corrections are not needed.</p>
<ul class="simple">
<li><p>If you want to quantify a fluorescence reporter you can take long tracks (<code class="docutils literal notranslate"><span class="pre">Edit</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Manually</span> <span class="pre">change</span> <span class="pre">data</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Batch</span> <span class="pre">deletion</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Delete</span> <span class="pre">short</span> <span class="pre">lineages</span></code>) and work from there.</p></li>
<li><p>If you want to quantify tissue flows flawless trajectories are often overkill. Setting a lower probability threshold should still give you good enough data.</p></li>
<li><p>Analyzing cell cycle dynamics should be done using survival analysis (<a class="reference internal" href="SURVIVAL_ANALYSIS.html"><span class="doc std std-doc">See here for how to do this</span></a>) anyway and this can deal with cells that are lost to follow up. So it is not a problem to use the uncorrected filtered data.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="MANUAL_TRACKING.html" class="btn btn-neutral float-left" title="Manual tracking and error correction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="PLUGIN_TUTORIAL.html" class="btn btn-neutral float-right" title="Plugin tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2025, Jeroen van Zon Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>